# MIPS 指令系统规范学习

### 编程模式

1. 数据格式

    比特、字节、半字、字

2. 寄存器

    - 32个32位通用寄存器
    - HI/LO 寄存器。HI 寄存器存放乘法指令结果的高半部分或是除法指令结果的余数，LO 寄存器存放乘法指令结果的低半部分或是除法指令结果的商。
    - 程序计数器 （PC），但实际上它根本没有计数功能。
    - 控制寄存器（CP0）。一组用于中断、例外控制的寄存器。

3. 大小端

    大端是 高低高低，高地址存放在低字节。

    小端是 高高低低，高地址存放在高字节。

    处理器中的字节顺序和比特顺序均采用小端模式。因为这是更符合计算机的读取模式，大端更适合人类阅读。

### 操作模式

处理器永远处于核心态（kernel mode）。该模式下处理器可以执行所有指令，访问 32 位全地址空间。

### 指令定义

1. 所有指令长度均为32比特。

2. 除个别指令外，所有指令的格式均为立即数型（I-Type）、跳转型（J-Type）和寄存器型（R-Type）三种类型
    中的一种。

    ![image-20241115122317405](C:/Users/HDQ/AppData/Roaming/Typora/typora-user-images/image-20241115122317405.png)

1. 算术运算指令

    - `ADD rd, rs, rt`

        功能描述：将寄存器rs的值与寄存器rt的值相加，结果写入寄存器rd中。如果产生溢出，则触发整型溢出例外（IntegerOverflow）。

        操作定义：首先将两个操作数分别和自己的最高位进行位拼接运算，然后两个数相加将其存入tmp[31:0]中。判断tmp[32] 和tmp[31]，如果相等则说明没有溢出就赋值 `GPR[rd] = tmp31..0`，不相等就溢出了然后进行处理。

    - `ADDI rt, rs, imm`

        功能描述：将寄存器rs的值与有符号扩展至32位的立即数imm相加，结果写入rt寄存器中。如果产生溢出，则触发整型溢出例外（IntegerOverflow）。

        操作定义：将寄存器rs的第一位拼接到rs的值上去，然后将立即数imm扩展至32位，再相加。判断是否溢出

    - `ADDU rd, rs, rt`

        功能描述：将寄存器rs的值和rt的值相加，结果写入rd寄存器中。

    - `ADDIU rt, rs, imm`

        功能描述：将寄存器rs的值与 *有符号扩展* 至32位的立即数 imm 相加，结果写入 rt 寄存器。

    - `SUB rd, rs, rt`

        功能描述：将寄存器rs的值与寄存器rt的值相减，结果写入rd寄存器中。如果产生溢出，则触发整型溢出例外（IntegerOverflow）。

        操作定义：首先将两个操作数分别和自己的最高位进行位拼接运算，然后两个数相减将其存入tmp[31:0]中。判断tmp[32] 和tmp[31]，如果相等则说明没有溢出就赋值 `GPR[rd] = tmp31..0`，不相等就溢出了然后进行处理。

    - `SUBU rd, rs, rt`

        功能描述：将寄存器rs的值与寄存器rt的值相减，结果写入rd寄存器中。

    - `SLT rd, rt, rs`

        功能描述：将寄存器rs的值与寄存器rt中的值进行有符号数比较，如果寄存器rs中的值小，则寄存器rd置1；否则寄存器rd置0。

    - `SLTI rt, rs, imm`

        功能描述：将寄存器rs的值与有符号扩展至32位的立即数imm进行有符号数比较，如果寄存器rs中的值小，则寄存器rt置1；否则寄存器rt置0。

    - `SLTU rd, rs, rt`

        功能描述：将寄存器rs的值与寄存器rt中的值进行无符号数比较，如果寄存器rs中的值小，则寄存器rd置1；否则寄存器rd置0。

        操作定义：首先将 0 拼接到两个操作数的首位，然后比较。

    - `SLTIU rt, rs, imm`

        功能描述：将寄存器rs的值与有符号扩展．．．．．至32位的立即数imm进行无符号数比较，如果寄存器rs中的值小，则寄存器rt置1；否则寄存器rt置0。

        操作定义：用 0 和rs的值拼接和 imm 比较。

    - `DIV rs, rt`

        功能描述：有符号除法，寄存器rs的值除以寄存器rt的值，商写入LO寄存器中，余数写入HI寄存器中。

    - `DIVU rs, rt`

        功能描述：无符号除法，寄存器rs的值除以寄存器rt的值，商写入LO寄存器中，余数写入HI寄存器中。

    - `MULT rs, rt`

        功能描述：有符号乘法，寄存器rs的值乘以寄存器rt的值，乘积的低半部分和高半部分分别写入LO寄存器和HI寄存器。

    - `MULTU rs, rt`

        功能描述：无符号乘法，寄存器rs的值乘以寄存器rt的值，乘积的低半部分和高半部分分别写入LO寄存器和HI寄存器。

2. 逻辑运算指令

    1. `AND rd, rs, rt`

        功能描述：寄存器rs中的值与寄存器rt中的值按位逻辑与，结果写入寄存器rd中。

    2. `ANDI rt, rs, imm`

        寄存器rs中的值与0扩展至32位的立即数imm按位逻辑与，结果写入寄存器rt中。

    3. `LUI rt, imm`

        功能描述：将16位立即数imm写入寄存器rt的高16位，寄存器rt的低16位置0。

    4. `NOR rd, rs, rt`

        功能描述：寄存器rs中的值与寄存器rt中的值按位逻辑或非，结果写入寄存器rd中。

    5. `OR rd, rs, rt
        `

        功能描述：寄存器rs中的值与寄存器rt中的值按位逻辑或，结果写入寄存器rd中。

    6. `ORI rt, rs, imm`

        功能描述：寄存器rs中的值与0扩展至32位的立即数imm按位逻辑或，结果写入寄存器rt中。

    7. `XOR rd, rs, rt
        `

        功能描述：寄存器rs中的值与寄存器rt中的值按位逻辑异或，结果写入寄存器rd中。

    8. `XORI rt, rs, imm`

        功能描述：寄存器rs中的值与0扩展至32位的立即数imm按位逻辑异或，结果写入寄存器rt中。

3. 移位指令

4. 分支跳转指令

5. 数据移动指令

6. 自陷指令

7. 访存指令

8. 特权指令

#### 存储管理